---
- name: Setup Development Environment
  hosts: localhost
  connection: local
  gather_facts: false
  vars:
    dotfiles_dir: "{{ lookup('env', 'HOME') }}/dotfiles/config"
    required_packages:
      - git
      - zsh
      - stow
      - curl
      - neovim

  pre_tasks:
    - name: Update apt cache and upgrade all packages
      become: yes
      ansible.builtin.apt:
        update_cache: yes
        cache_valid_time: 3600
        upgrade: dist

    - name: Install all required system packages
      become: true
      ansible.builtin.apt:
        name: "{{ required_packages }}"
        state: present
        update_cache: yes
      when: required_packages | length > 0

  tasks:
    - name: Run development tools setup tasks
      ansible.builtin.include_tasks:
        file: "{{ item }}"
      loop: "{{ query('fileglob', 'tasks/*.yml') }}"
      loop_control:
        loop_var: item

    - name: Display completion status
      ansible.builtin.debug:
        msg: "All development tools have been installed and configured"
